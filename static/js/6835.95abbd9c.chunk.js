"use strict";(self.webpackChunknowa=self.webpackChunknowa||[]).push([[6835],{87268:function(e,t,n){n.r(t),n.d(t,{default:function(){return g}});var a=n(74165),r=n(15861),i=n(1413),c=n(93433),o=n(29439),s=n(72791),l=n(88823),d=n(45644),u=n(42713),p=n(20160),m=n(79627),h=n(43360),f=n(16871),v=n(43504),x=n(24490),Z=n(92574),b=n(80184),g=function(){var e=(0,s.useState)([]),t=(0,o.Z)(e,2),n=t[0],g=t[1],j=(0,s.useState)([]),_=(0,o.Z)(j,2),N=_[0],k=_[1],C=(0,s.useState)(0),w=(0,o.Z)(C,2),S=w[0],y=w[1],F=(0,s.useState)(new Set),I=(0,o.Z)(F,2),z=I[0],R=I[1],P=localStorage.getItem("form_quote_id"),B=(0,s.useState)(0),E=(0,o.Z)(B,2),q=E[0],H=E[1],M=(0,d.i)().getAllData,A=(0,d.i)().postData,D=(0,x.VY)(),O=D.handleInfoAlert,V=D.handleErrorAlert,L=(0,f.s0)(),U=(0,s.useState)({quote_id:P,items:[]}),$=(0,o.Z)(U,2),T=$[0],Q=$[1],Y=""===T.discount_id||"seleccionar"===T.discount_id||null===T.discount_id||void 0===T.discount_id,G=(0,s.useCallback)((function(e){var t=new Set(z);if(t.has(e))t.delete(e),J(e,"discount",0,n[e].quantity);else{t.add(e);var a=T.items.findIndex((function(t){return t.item_id===n[e].item_price_id}));if(-1!==a){var r=(0,c.Z)(T.items);r[a]=(0,i.Z)((0,i.Z)({},r[a]),{},{value:n[e].quantity,discount:0,is_discount_percentage:"0"}),Q((0,i.Z)((0,i.Z)({},T),{},{items:r}))}else{var o=(0,c.Z)(T.items);o.push({item_id:n[e].item_price_id,value:n[e].quantity,discount:0,is_discount_percentage:"0"}),Q((0,i.Z)((0,i.Z)({},T),{},{items:o}))}}R(t)}),[z,n,T]),J=(0,s.useCallback)((function(e,t,a,r){Q((function(o){var s=(0,c.Z)(o.items);if(e>=s.length&&s.push({item_id:n[e].item_price_id,value:r,discount:0,is_discount_percentage:"0"}),"is_discount_percentage"===t)if(s[e].is_discount_percentage=a,"1"===a)s[e].discount=0;else{var l=n[e].price,d=Math.max(0,Math.min(a,l));s[e].discount=d}else if("discount"===t)if("0"===s[e].is_discount_percentage){var u=n[e].price,p=Math.max(0,Math.min(a,u));s[e].discount=p}else{var m=Math.max(0,Math.min(a,100));s[e].discount=m}return H(e),(0,i.Z)((0,i.Z)({},o),{},{items:s})}))}),[T]),K=function(e){Q((function(t){return(0,i.Z)((0,i.Z)({},t),{},{discount_id:parseInt(e)})}))},W=function(){var e=(0,r.Z)((0,a.Z)().mark((function e(){var t;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=(0,i.Z)((0,i.Z)({},T),{},{items:T.items.map((function(e){var t;return(0,i.Z)((0,i.Z)({},e),{},{value:0===e.value?(null===(t=n.find((function(t){return t.item_price_id===e.item_id})))||void 0===t?void 0:t.quantity)||"0":e.value,discount:e.discount||"0",is_discount_percentage:e.is_discount_percentage||"0"})}))}),e.next=4,A(t,"quotes/items/save",!1,"cotizacionpdf");case 4:e.next=10;break;case 6:e.prev=6,e.t0=e.catch(0),V("Ha ocurrido un error con el descuento a aplicar, intente nuevamente"),console.error("Error in createItem:",e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(){return e.apply(this,arguments)}}(),X=[{Header:"N\xb0",accessor:"",className:"wd-5p borderrigth",Cell:function(e){var t=e.row.index+1;return(0,b.jsx)("span",{children:t})}},{Header:"Nombre Items",accessor:"name",Cell:function(e){var t=e.value;return(0,b.jsx)("span",{children:t.toUpperCase()})}},{Header:"Cantidad",accessor:"quantity"},{Header:"Precio",accessor:"price",Cell:function(e){var t=e.value;e.row;return(0,b.jsx)("span",{children:"$ ".concat(t)})}},{Header:"Descuento",accessor:"value",Cell:function(e){var t=e.value,n=e.row;return(0,b.jsx)(l.Z,{checked:z.has(n.index),color:1===t?"success":"warning",onChange:function(){return G(n.index)}})}}];z.size>0&&(X=[].concat((0,c.Z)(X),[{Header:"Porcentaje",accessor:"",Cell:function(e){var t,n=e.row;return z.has(n.index)?(0,b.jsxs)(p.Z.Select,{value:(null===(t=T.items[n.index])||void 0===t?void 0:t.is_discount_percentage)||"","aria-label":"Default select example",onChange:function(e){return J(n.index,"is_discount_percentage",e.target.value)},className:"form-control",children:[(0,b.jsx)("option",{className:"option",value:"1",children:"Si"}),(0,b.jsx)("option",{className:"option",value:"0",children:"No"})]}):null}},{Header:"Valor descuento",accessor:"",Cell:function(e){var t,n=e.row;return z.has(n.index)?(0,b.jsx)(p.Z.Control,{className:"form-control",type:"text",autoFocus:n.index===q,required:!0,value:(null===(t=T.items[n.index])||void 0===t?void 0:t.discount)||"",onChange:function(e){return J(n.index,"discount",e.target.value)}}):null}}])),X=[].concat((0,c.Z)(X),[{Header:"Quitar",accessor:"",className:"wd-15p borderrigth",Cell:function(e){var t=e.row;return(0,b.jsxs)("div",{className:"d-flex align-items-center gap-1 cursor-pointer",onClick:function(){return function(e){var t=n.filter((function(t){return t.item_price_id!==e})),a=T.items.filter((function(t){return t.item_id!==e}));g(t),Q((0,i.Z)((0,i.Z)({},T),{},{items:a}))}(t.original.item_price_id)},children:[(0,b.jsx)("span",{className:"material-icons md-5 md-dark",children:"\ue872"}),"Quitar"]})}}]);var ee=P?n.reduce((function(e,t){return e+parseFloat(t.amount)}),0):0;(0,s.useEffect)((function(){var e=function(){var e=(0,r.Z)((0,a.Z)().mark((function e(){var t,n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,M("api/quotes/items/".concat(P));case 3:return t=e.sent,e.next=6,M("api/discount/list/active");case 6:n=e.sent,t.content&&Array.isArray(t.content)?(g(t.content),Q((function(e){return(0,i.Z)((0,i.Z)({},e),{},{items:t.content.map((function(e){return{item_id:e.item_price_id,value:0,discount:0,is_discount_percentage:"0"}}))})}))):(console.error("Respuesta inv\xe1lida:",t),O("No hay descuentos para aplicar.","/cotizar")),k(n),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),console.error(e.t0);case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(){return e.apply(this,arguments)}}();e()}),[L]),(0,s.useEffect)((function(){if(n.length>0){var e=Array.from(z).reduce((function(e,t){var a=T.items[t];a&&"1"===a.is_discount_percentage?e+=n[t].price*(a.discount/100):e+=parseFloat(a.discount||0);return e}),0);y(e)}}),[z,n,T.items]);var te=function(e){e.totalAmount;var t=n.reduce((function(e,t){return e+parseFloat(t.price)}),0),a=N.find((function(e){return e.id===T.discount_id})),r=t-S,i=0;if(a)if(0===a.is_percentage)r-=i=parseFloat(a.amount);else if(1===a.is_percentage){var c=t*parseFloat(a.amount)/100;r-=c,i=c}return r<0&&(O("Verificar descuentos para poder continuar"),r=0),(0,b.jsx)(m.Z,{children:(0,b.jsx)(m.Z.Body,{className:"px-3",children:(0,b.jsx)("div",{className:"table-responsive",children:(0,b.jsx)("table",{className:"table mb-0 ",children:(0,b.jsxs)("tbody",{children:[(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"text-center",children:(0,b.jsx)("span",{className:"tabletitle fw-bold text-uppercase",children:"Descuento"})}),(0,b.jsx)("th",{className:"text-center",children:(0,b.jsx)("div",{className:"d-flex align-items-start flex-column ",children:T.discount_id?(0,b.jsx)(p.Z.Select,{name:"discount_id","aria-label":"Default select example",onChange:function(e){return K(e.target.value)},value:T.discount_id,children:N.map((function(e){return(0,b.jsx)("option",{className:"",value:e.id,children:e.name},e.id)}))}):(0,b.jsxs)(p.Z.Select,{name:"discount_id","aria-label":"Default select example",onChange:function(e){return K(e.target.value)},value:"",children:[N.some((function(e){return"No Aplicar Descuento"===e.name}))&&(0,b.jsx)("option",{value:"",children:"No aplicar descuento"}),N.filter((function(e){return"No aplicar descuento"!==e.name})).map((function(e){return(0,b.jsx)("option",{value:e.id,children:e.name},e.id)}))]})})})]}),(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"text-center",children:(0,b.jsx)("span",{className:"tabletitle fw-bold text-uppercase",children:"Subtotal"})}),(0,b.jsx)("th",{className:"text-center",children:(0,b.jsxs)("span",{className:"tabletitle",children:[(0,b.jsx)("b",{children:"$"}),(0,Z.u)(t,2)]})})]}),(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"text-center",children:(0,b.jsx)("span",{className:"tabletitle fw-bold text-uppercase",children:"Descuentos"})}),(0,b.jsx)("th",{className:"text-center",children:(0,b.jsxs)("span",{className:"tabletitle",children:[(0,b.jsx)("b",{children:"$"})," ",(0,Z.u)(i+S,2)," "]})})]}),(0,b.jsxs)("tr",{className:"bg-darkorange text-light",children:[(0,b.jsx)("th",{className:"text-center",children:(0,b.jsx)("span",{className:"tabletitle fw-bold text-uppercase",children:"Total"})}),(0,b.jsx)("th",{className:"text-center",children:(0,b.jsxs)("span",{className:"tabletitle",children:[(0,b.jsx)("b",{children:"$"})," ",(0,Z.u)(r,2)," "]})})]})]})})})})})};return(0,b.jsxs)("div",{children:[(0,b.jsx)(u.cI,{items:["inicio","lista DE DESCEUNTOS"],baseURL:["inicio","nexos/listadescuentos"]}),(0,b.jsx)(u.r3,{title:"DESCUENTOS A APLICAR"}),(0,b.jsx)(u.L4,{columns:X,data:n,totalFunc:function(){return(0,b.jsx)(te,{totalAmount:ee})}}),(0,b.jsxs)("div",{className:"text-end",children:[(0,b.jsx)(v.rU,{to:"".concat("","/nexos/cotizacionpdf"),className:"header-logo",children:(0,b.jsx)(h.Z,{variant:"",className:"btn btn-primary me-2",children:"Volver"})}),(0,b.jsx)(h.Z,{variant:"",className:"btn btn-primary",onClick:W,disabled:Y,children:"Continuar"})]})]})}},92574:function(e,t,n){n.d(t,{u:function(){return a}});var a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n="string"===typeof e?parseFloat(e):Number(e);if(isNaN(n))throw new Error("El valor proporcionado no es un n\xfamero v\xe1lido.");var a=Number.isInteger(n)?n.toLocaleString():n.toFixed(t).replace(/\B(?=(\d{3})+(?!\d))/g,",");return a}},88823:function(e,t,n){n.d(t,{Z:function(){return q}});var a=n(4942),r=n(63366),i=n(87462),c=n(72791),o=n(94419),s=n(12065),l=n(29439),d=n(28182),u=n(49853),p=n(9367),m=n(15178),h=n(90529),f=n(71625),v=n(21217),x=n(75878);function Z(e){return(0,v.Z)("PrivateSwitchBase",e)}(0,x.Z)("PrivateSwitchBase",["root","checked","disabled","input","edgeStart","edgeEnd"]);var b=n(80184),g=["autoFocus","checked","checkedIcon","className","defaultChecked","disabled","disableFocusRipple","edge","icon","id","inputProps","inputRef","name","onBlur","onChange","onFocus","readOnly","required","tabIndex","type","value"],j=(0,p.ZP)(f.Z)((function(e){var t=e.ownerState;return(0,i.Z)({padding:9,borderRadius:"50%"},"start"===t.edge&&{marginLeft:"small"===t.size?-3:-12},"end"===t.edge&&{marginRight:"small"===t.size?-3:-12})})),_=(0,p.ZP)("input")({cursor:"inherit",position:"absolute",opacity:0,width:"100%",height:"100%",top:0,left:0,margin:0,padding:0,zIndex:1}),N=c.forwardRef((function(e,t){var n=e.autoFocus,a=e.checked,c=e.checkedIcon,s=e.className,p=e.defaultChecked,f=e.disabled,v=e.disableFocusRipple,x=void 0!==v&&v,N=e.edge,k=void 0!==N&&N,C=e.icon,w=e.id,S=e.inputProps,y=e.inputRef,F=e.name,I=e.onBlur,z=e.onChange,R=e.onFocus,P=e.readOnly,B=e.required,E=e.tabIndex,q=e.type,H=e.value,M=(0,r.Z)(e,g),A=(0,m.Z)({controlled:a,default:Boolean(p),name:"SwitchBase",state:"checked"}),D=(0,l.Z)(A,2),O=D[0],V=D[1],L=(0,h.Z)(),U=f;L&&"undefined"===typeof U&&(U=L.disabled);var $="checkbox"===q||"radio"===q,T=(0,i.Z)({},e,{checked:O,disabled:U,disableFocusRipple:x,edge:k}),Q=function(e){var t=e.classes,n=e.checked,a=e.disabled,r=e.edge,i={root:["root",n&&"checked",a&&"disabled",r&&"edge".concat((0,u.Z)(r))],input:["input"]};return(0,o.Z)(i,Z,t)}(T);return(0,b.jsxs)(j,(0,i.Z)({component:"span",className:(0,d.Z)(Q.root,s),centerRipple:!0,focusRipple:!x,disabled:U,tabIndex:null,role:void 0,onFocus:function(e){R&&R(e),L&&L.onFocus&&L.onFocus(e)},onBlur:function(e){I&&I(e),L&&L.onBlur&&L.onBlur(e)},ownerState:T,ref:t},M,{children:[(0,b.jsx)(_,(0,i.Z)({autoFocus:n,checked:a,defaultChecked:p,className:Q.input,disabled:U,id:$&&w,name:F,onChange:function(e){if(!e.nativeEvent.defaultPrevented){var t=e.target.checked;V(t),z&&z(e,t)}},readOnly:P,ref:y,required:B,ownerState:T,tabIndex:E,type:q},"checkbox"===q&&void 0===H?{}:{value:H},S)),O?c:C]}))})),k=n(81245),C=(0,k.Z)((0,b.jsx)("path",{d:"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"}),"CheckBoxOutlineBlank"),w=(0,k.Z)((0,b.jsx)("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"}),"CheckBox"),S=(0,k.Z)((0,b.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z"}),"IndeterminateCheckBox"),y=n(67254);function F(e){return(0,v.Z)("MuiCheckbox",e)}var I=(0,x.Z)("MuiCheckbox",["root","checked","disabled","indeterminate","colorPrimary","colorSecondary"]),z=["checkedIcon","color","icon","indeterminate","indeterminateIcon","inputProps","size"],R=(0,p.ZP)(N,{shouldForwardProp:function(e){return(0,p.FO)(e)||"classes"===e},name:"MuiCheckbox",slot:"Root",overridesResolver:function(e,t){var n=e.ownerState;return[t.root,n.indeterminate&&t.indeterminate,"default"!==n.color&&t["color".concat((0,u.Z)(n.color))]]}})((function(e){var t,n=e.theme,r=e.ownerState;return(0,i.Z)({color:(n.vars||n).palette.text.secondary},!r.disableRipple&&{"&:hover":{backgroundColor:n.vars?"rgba(".concat("default"===r.color?n.vars.palette.action.activeChannel:n.vars.palette.primary.mainChannel," / ").concat(n.vars.palette.action.hoverOpacity,")"):(0,s.Fq)("default"===r.color?n.palette.action.active:n.palette[r.color].main,n.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},"default"!==r.color&&(t={},(0,a.Z)(t,"&.".concat(I.checked,", &.").concat(I.indeterminate),{color:(n.vars||n).palette[r.color].main}),(0,a.Z)(t,"&.".concat(I.disabled),{color:(n.vars||n).palette.action.disabled}),t))})),P=(0,b.jsx)(w,{}),B=(0,b.jsx)(C,{}),E=(0,b.jsx)(S,{}),q=c.forwardRef((function(e,t){var n,a,s=(0,y.Z)({props:e,name:"MuiCheckbox"}),l=s.checkedIcon,d=void 0===l?P:l,p=s.color,m=void 0===p?"primary":p,h=s.icon,f=void 0===h?B:h,v=s.indeterminate,x=void 0!==v&&v,Z=s.indeterminateIcon,g=void 0===Z?E:Z,j=s.inputProps,_=s.size,N=void 0===_?"medium":_,k=(0,r.Z)(s,z),C=x?g:f,w=x?g:d,S=(0,i.Z)({},s,{color:m,indeterminate:x,size:N}),I=function(e){var t=e.classes,n=e.indeterminate,a=e.color,r={root:["root",n&&"indeterminate","color".concat((0,u.Z)(a))]},c=(0,o.Z)(r,F,t);return(0,i.Z)({},t,c)}(S);return(0,b.jsx)(R,(0,i.Z)({type:"checkbox",inputProps:(0,i.Z)({"data-indeterminate":x},j),icon:c.cloneElement(C,{fontSize:null!=(n=C.props.fontSize)?n:N}),checkedIcon:c.cloneElement(w,{fontSize:null!=(a=w.props.fontSize)?a:N}),ownerState:S,ref:t},k,{classes:I}))}))}}]);
//# sourceMappingURL=6835.95abbd9c.chunk.js.map